# 数字白板应用需求文档

## 1. 项目概述

### 1.1 项目名称

wl-draw - 数字白板绘图应用

### 1.2 项目目标

开发一个功能完善的数字白板应用，支持多种绘图工具、文本编辑、画布操作等功能，为用户提供流畅的绘图和编辑体验。

### 1.3 核心价值

- 提供直观、简洁的绘图界面
- 支持多种图形绘制工具
- 支持文本编辑和图片插入
- 提供完整的画布操作和视图控制
- 支持操作历史记录（撤销/重做）

### 1.4 实现状态

#### ✅ 已实现功能

- **绘图工具**：所有基础绘图工具已实现（选择、平移、矩形、圆形、直线、箭头、画笔、文本、图片）
- **画布操作**：缩放（鼠标滚轮、按钮）、平移（工具和空格键）、无限画布
- **对象管理**：对象添加、删除、选择、移动、缩放
- **插件化架构**：完整的工具插件系统，支持工具注册、生命周期管理、事件系统、Hook 系统、快捷键管理和依赖管理
- **样式管理**：颜色、粗细、字号等样式状态管理（状态已实现，UI 待完善）
- **快捷键支持**：所有工具支持键盘快捷键（如 I-图片、T-文本），支持快捷键冲突检测

#### ⏳ 待实现功能

- **历史记录**：撤销/重做功能
- **颜色选择器 UI**：颜色选择界面
- **文本样式**：粗体、斜体、下划线等文本样式设置
- **线条样式**：虚线等线条样式设置
- **图片 URL 输入**：支持通过 URL 插入图片
- **导出/导入**：画布内容导出和导入功能

## 2. 功能需求

### 2.1 绘图工具

#### 2.1.1 选择工具 ✅

- **功能描述**：用于选择、移动和调整画布上的对象
- **交互方式**：鼠标点击对象进行选择，拖拽移动位置，拖拽控制点调整大小
- **视觉反馈**：选中对象时显示选择框和控制点
- **快捷键**：V（KeyV）
- **实现状态**：已实现，使用 Leafer Editor 提供选择、移动和调整功能

#### 2.1.2 平移工具（抓手工具） ✅

- **功能描述**：用于移动画布视图，不改变对象位置
- **交互方式**：鼠标按下拖拽移动画布，支持空格键+拖拽临时切换为平移模式
- **图标**：手掌图标（i-lucide-hand）
- **快捷键**：Space（KeySpace）或空格键临时切换
- **实现状态**：已实现，支持工具切换和空格键快捷操作

#### 2.1.3 矩形工具 ✅

- **功能描述**：绘制矩形和正方形
- **交互方式**：鼠标按下拖拽绘制矩形，按住 Shift 键绘制正方形
- **样式**：支持填充颜色设置（边框颜色待实现）
- **图标**：空心正方形图标（i-lucide-square）
- **快捷键**：R（KeyR）
- **实现状态**：已实现，支持 Shift 键绘制正方形，绘制完成后自动切换到选择工具

#### 2.1.4 圆形工具 ✅

- **功能描述**：绘制圆形和椭圆
- **交互方式**：鼠标按下拖拽绘制椭圆，按住 Shift 键绘制正圆
- **样式**：支持填充颜色设置（边框颜色待实现）
- **图标**：空心圆形图标（i-lucide-circle）
- **快捷键**：C（KeyC）
- **实现状态**：已实现，支持 Shift 键绘制正圆，绘制完成后自动切换到选择工具

#### 2.1.5 直线工具 ✅

- **功能描述**：绘制直线段
- **交互方式**：鼠标按下拖拽绘制直线，按住 Shift 键绘制水平/垂直/45 度角直线
- **样式**：支持线条颜色、粗细设置（虚线样式待实现）
- **图标**：短横线图标（i-lucide-minus）
- **快捷键**：L（KeyL）
- **实现状态**：已实现，支持 Shift 键角度约束，绘制完成后自动切换到选择工具

#### 2.1.6 箭头工具 ✅

- **功能描述**：绘制带箭头的直线
- **交互方式**：鼠标按下拖拽绘制箭头，箭头指向拖拽结束位置，支持 Shift 键角度约束
- **样式**：支持线条颜色、粗细设置（箭头样式和大小自定义待实现）
- **图标**：带箭头的直线图标（使用 @leafer-in/arrow 插件）
- **快捷键**：A（KeyA）
- **实现状态**：已实现，使用 Leafer Line 组件配合 endArrow 属性，绘制完成后自动切换到选择工具

#### 2.1.7 自由绘制工具（画笔） ✅

- **功能描述**：自由绘制曲线和手写
- **交互方式**：鼠标按下移动自由绘制
- **样式**：支持画笔颜色、粗细设置（平滑度设置待实现）
- **图标**：画笔/铅笔图标（i-lucide-pen-tool）
- **快捷键**：P（KeyP）
- **实现状态**：已实现，使用 Leafer Pen 组件，支持平滑绘制，绘制完成后自动切换到选择工具

### 2.2 文本工具

#### 2.2.1 文本添加 ✅

- **功能描述**：在画布上添加文本
- **交互方式**：点击文本工具后在画布上点击位置添加文本框，进入编辑模式
- **图标**：大写字母 "A" 图标（i-lucide-type）
- **快捷键**：T（KeyT）
- **实现状态**：已实现，使用 Leafer Text 组件和 @leafer-in/text-editor 插件，支持文本编辑

#### 2.2.2 文本编辑 ⏳

- **功能**：支持文本内容的编辑、删除
- **样式设置**：
  - ✅ 字号：支持字号大小设置（状态已实现，UI 待完善）
  - ✅ 颜色：支持文本颜色设置（状态已实现，UI 待完善）
  - ⏳ 样式：支持粗体、斜体、下划线等样式（待实现）
  - ⏳ 对齐：支持左对齐、居中、右对齐（如果支持多行）（待实现）
- **实现状态**：基础编辑功能已实现，样式设置 UI 待完善

#### 2.2.3 文本移动 ✅

- **功能**：支持文本对象的移动和位置调整
- **实现状态**：已实现，通过选择工具支持移动和调整

### 2.3 图片插入

#### 2.3.1 插入图片 ⏳

- **功能描述**：在画布上插入图片
- **交互方式**：点击图片图标，选择本地图片文件（URL 输入待实现）
- **支持格式**：JPG、PNG、GIF、SVG 等常见图片格式
- **图标**：图片图标（i-lucide-image）
- **快捷键**：I（KeyI）
- **实现状态**：本地文件选择已实现，URL 输入功能待实现

#### 2.3.2 图片操作 ⏳

- **功能**：支持图片的移动、缩放、删除（旋转待实现）
- **约束**：保持图片宽高比
- **实现状态**：移动、缩放、删除已实现，旋转功能待实现

### 2.4 画布操作

#### 2.4.1 缩放功能 ✅

- **功能描述**：放大和缩小画布视图
- **操作方式**：
  - ✅ 点击加号图标放大（每次增加 10%）
  - ✅ 点击减号图标缩小（每次减少 10%）
  - ✅ 支持鼠标滚轮缩放（缩放速度 0.1）
  - ✅ 点击缩放比例按钮重置到 100%
- **显示**：显示当前缩放比例（如 "100%"）
- **缩放范围**：2% ~ 25600%（0.02 ~ 256 倍）
- **实现状态**：已实现，缩放控件位于顶部工具栏，使用 Leafer Viewport 插件

#### 2.4.2 平移功能 ✅

- **功能描述**：通过抓手工具平移画布视图
- **操作方式**：使用平移工具或按住空格键+鼠标拖拽
- **实现状态**：已实现，支持工具切换和空格键快捷操作

#### 2.4.3 画布属性 ✅

- **画布尺寸**：无限画布、无限滚动
- **画布背景**：浅灰色（#F5F5F5）
- **实现状态**：已实现，使用 Leafer App 和 Viewport 插件

### 2.5 历史记录 ⏳

#### 2.5.1 撤销操作 ⏳

- **功能描述**：撤销上一步操作
- **操作方式**：点击撤销图标或使用快捷键（Ctrl/Cmd + Z）
- **图标**：左向箭头图标
- **限制**：支持多步撤销，建议至少支持 50 步历史记录
- **实现状态**：待实现

#### 2.5.2 重做操作 ⏳

- **功能描述**：恢复被撤销的操作
- **操作方式**：点击重做图标或使用快捷键（Ctrl/Cmd + Shift + Z）
- **图标**：右向箭头图标
- **实现状态**：待实现

### 2.6 删除功能 ✅

#### 2.6.1 删除对象

- **功能描述**：删除选中的对象
- **操作方式**：选中对象后按 Delete 或 Backspace 键
- **实现状态**：已实现，支持删除单个或多个选中对象

## 3. UI/UX 需求

### 3.1 界面布局

#### 3.1.1 顶部工具栏 ✅

- **位置**：画布上方居中（固定定位）
- **内容**：包含所有绘图工具和缩放控件
- **样式**：
  - ✅ 工具图标清晰可识别（使用 Iconify 图标）
  - ✅ 当前选中工具高亮显示（primary 类型按钮）
  - ✅ 支持工具提示（Tooltip）
  - ✅ 图标间距适中，易于点击（圆角卡片样式，毛玻璃效果）
- **实现状态**：已实现，工具栏包含工具选择器和缩放控件

#### 3.1.2 底部工具栏 ⏳

- **位置**：画布下方（待实现）
- **内容**：历史操作（撤销/重做）
- **样式**：
  - 图标清晰可识别
- **实现状态**：待实现（撤销/重做功能待实现）

#### 3.1.3 中央画布区域 ✅

- **位置**：占据剩余空间
- **样式**：
  - ✅ 默认背景为浅灰色（#F5F5F5）
  - ✅ 支持无限画布
  - ✅ 支持无限滚动
- **实现状态**：已实现

### 3.2 交互体验

#### 3.2.1 工具切换 ✅

- ✅ 点击工具栏图标切换工具
- ✅ 当前选中工具视觉反馈明显（高亮/激活状态）
- ✅ 工具切换时自动设置画布模式（normal/draw）
- **实现状态**：已实现

#### 3.2.2 绘制反馈 ✅

- ✅ 绘制过程中实时预览
- ✅ 绘制完成后的对象可立即编辑（自动切换到选择工具并选中对象）
- **实现状态**：已实现

#### 3.2.3 选择反馈 ✅

- ✅ 选中对象时显示选择框（使用 Leafer Editor）
- ✅ 选择框四角和边缘中点显示控制点（用于调整大小）
- **实现状态**：已实现，由 Leafer Editor 提供

### 3.3 颜色选择 ⏳

#### 3.3.1 颜色选择器 ⏳

- 需要提供颜色选择器用于设置：
  - ⏳ 填充颜色（矩形、圆形）- 状态已实现，UI 待完善
  - ⏳ 线条颜色（直线、箭头、画笔）- 状态已实现，UI 待完善
  - ⏳ 文本颜色 - 状态已实现，UI 待完善
- **实现状态**：颜色状态管理已实现（store 中存储 fillColor、strokeColor、textColor），颜色选择器 UI 待实现

## 4. 技术需求

### 4.1 技术栈

- **框架**：Vue 3（已确认）
- **语言**：TypeScript（已确认）
- **构建工具**：Vite（已确认）
- **UI 组件库**：Naive UI（已集成，支持自动按需导入）
- **状态管理**：Pinia（已集成）
- **CSS 框架**：Tailwind CSS v4（已集成，使用 @tailwindcss/vite 插件）
- **图标库**：Iconify（已集成，使用 unplugin-icons 支持自动导入，200,000+ 图标）
- **绘图引擎**：Leafer（已集成，包含 leafer 核心库和 leafer-draw 绘图库）
- **快捷键支持**：VueUse（已集成，用于键盘事件处理和快捷键绑定）

### 4.2 核心技术点

#### 4.2.1 绘图引擎

- **已确定**：使用 Leafer 作为绘图引擎（已集成）
  - **核心库**：`leafer-ui` - 提供基础画布和渲染能力
  - **扩展插件**：
    - `@leafer-in/editor` - 提供对象编辑功能（选择、移动、缩放）
    - `@leafer-in/viewport` - 提供视口和缩放功能
    - `@leafer-in/view` - 提供视图功能
    - `@leafer-in/arrow` - 提供箭头绘制功能
    - `@leafer-in/text-editor` - 提供文本编辑功能
  - **特性**：
    - 高性能 Canvas 渲染引擎
    - 支持多种图形元素（Rect、Ellipse、Path、Line、Pen、Text、Image）
    - 支持对象拖拽、缩放、旋转（通过 Editor）
    - 支持无限画布和视图操作（通过 Viewport）
    - 良好的 TypeScript 类型支持

#### 4.2.2 状态管理

- ✅ 需要管理画布上的所有对象（图形、文本、图片）- 已实现
- ⏳ 需要管理操作历史记录（用于撤销/重做）- 待实现
- **已确定**：使用 Pinia 进行状态管理（已集成）
- **实现状态**：
  - ✅ 工具状态管理（currentTool、previousTool）
  - ✅ 对象管理（objects 数组）
  - ✅ 样式状态管理（fillColor、strokeColor、strokeWidth、fontSize、textColor）
  - ✅ 缩放状态管理（zoom）
  - ⏳ 历史记录管理（待实现）

#### 4.2.3 事件处理

- **鼠标事件**：click、mousedown、mousemove、mouseup
  - 由 Leafer 引擎提供原生事件支持
  - 支持对象选择、拖拽、缩放等交互操作
- **键盘事件**：快捷键支持
  - **已确定**：使用 VueUse 处理键盘快捷键（已集成）
  - 支持组合键（如 Ctrl/Cmd + Z、Ctrl/Cmd + S）
  - 支持按键状态检测
  - 提供响应式的快捷键管理能力
  - **工具快捷键**：
    - V（KeyV）- 选择工具
    - Space（KeySpace）- 平移工具
    - R（KeyR）- 矩形工具
    - C（KeyC）- 圆形工具
    - L（KeyL）- 直线工具
    - A（KeyA）- 箭头工具
    - P（KeyP）- 画笔工具
    - T（KeyT）- 文本工具
    - I（KeyI）- 图片工具
  - **操作快捷键**：
    - Delete/Backspace - 删除选中对象
    - Space + 拖拽 - 临时切换到平移模式

#### 4.2.4 插件系统架构 ✅

- **已实现**：完整的插件化架构系统
- **核心组件**：
  - **插件注册表（PluginRegistry）**：管理插件的注册、注销、查询和状态管理
  - **事件系统（PluginEventBus/PluginEventManager）**：提供插件间通信机制
  - **Hook 系统**：支持生命周期钩子（beforeToolSwitch、afterToolSwitch、beforeDrawingStart、afterDrawingStart、beforeDrawingFinish、afterDrawingFinish）
  - **快捷键系统**：支持快捷键定义、解析、冲突检测和规范化
  - **依赖管理**：支持插件依赖声明和循环依赖检测
- **插件特性**：
  - 插件验证（metadata、依赖、版本检查）
  - 插件生命周期（onInstall、onUninstall）
  - 插件状态跟踪（registered、activated、deactivated、error）
  - 插件分类（drawing、selection、utility）
  - 插件能力声明（requiresDrawMode、handlesTap 等）
- **内置插件**：所有绘图工具均以插件形式实现（select、pan、rect、circle、line、arrow、pen、text、image）
- **实现状态**：已完整实现，支持工具的动态注册和切换

#### 4.2.5 数据持久化 ⏳

- ⏳ 支持导出画布内容（PNG、SVG、JSON 格式）- 待实现
- ⏳ 支持导入画布内容（JSON 格式）- 待实现
- ⏳ 可选：本地存储（LocalStorage）自动保存 - 待实现
- **实现状态**：待实现

### 4.3 性能要求

- 流畅的绘制体验（60fps）
- 支持至少 100 个对象同时存在
- 快速响应用户操作（延迟 < 100ms）

### 4.4 开发工具和配置

#### 4.4.1 自动导入配置

- **unplugin-auto-import**：自动导入 Vue、Naive UI、Pinia 的 API

  - Vue: `ref`, `computed`, `watch` 等
  - Naive UI: `useDialog`, `useMessage`, `useNotification`, `useLoadingBar`
  - Pinia: `defineStore`, `storeToRefs`

- **unplugin-vue-components**：自动导入组件
  - Naive UI 组件自动导入
  - Iconify 图标组件自动导入（前缀：`i-{图标集}:{图标名}`）

#### 4.4.2 样式配置

- **Tailwind CSS v4**：使用 Vite 插件方式集成
  - CSS 语法：`@import "tailwindcss"`
  - 零配置，自动扫描项目文件
  - 支持响应式设计和工具类

#### 4.4.3 代码规范

- **Biome**：代码质量检查和格式化（已配置）
  - 支持 lint 和 format
  - 集成 lint-staged 和 husky 进行提交前检查
- **TypeScript**：严格模式，完整类型检查
- **代码风格**：
  - 文件级文档注释（必需）
  - 语义化命名
  - 避免冗余注释

### 4.5 兼容性要求

- 现代浏览器支持（Chrome、Firefox、Safari、Edge 最新版本）

---

**文档版本**：v1.4  
**创建日期**：2025  
**最后更新**：2025-11-13

### 更新日志

#### v1.4 (2025-11-13)

- 更新插件系统说明：
  - 添加插件系统架构详细说明（PluginRegistry、事件系统、Hook 系统、快捷键系统、依赖管理）
  - 记录插件系统的核心特性和能力
  - 说明所有绘图工具均以插件形式实现
- 更新工具快捷键信息：
  - 添加所有工具的完整快捷键说明（V-选择、Space-平移、R-矩形、C-圆形、L-直线、A-箭头、P-画笔、T-文本、I-图片）
  - 更新删除功能的快捷键说明（Delete/Backspace）
  - 添加空格键临时切换平移模式的说明
- 更新缩放功能细节：
  - 添加缩放步长说明（每次 10%）
  - 添加鼠标滚轮缩放速度说明（0.1）
  - 明确缩放范围的计算方式
- 完善功能实现状态标注

#### v1.3 (2025-11-12)

- 添加实现状态说明：
  - 标注所有功能的实现状态（✅ 已实现、⏳ 待实现）
  - 更新已实现功能的详细说明
  - 记录实际使用的技术细节（Leafer 插件、图标名称等）
  - 添加删除功能说明
  - 更新界面布局实现状态
  - 更新技术实现细节（Leafer 插件列表、状态管理实现情况）
  - 更新代码规范说明（Biome 替代 ESLint/Prettier）

#### v1.2 (2025-11-11)

- 更新技术需求部分：
  - 确定并使用 Leafer 作为绘图引擎（包含 leafer 和 leafer-draw）
  - 集成 VueUse 用于快捷键支持
  - 更新绘图引擎和事件处理的详细说明

#### v1.1 (2025-11-10)

- 更新技术栈部分，记录已集成技术：
  - Naive UI 组件库集成
  - Pinia 状态管理集成
  - Tailwind CSS v4 集成
  - Iconify 图标库集成
