# wl-draw

数字白板绘图应用，基于 Vue 3 和 Leafer UI 构建，提供流畅的绘图和编辑体验。

## 项目简介

wl-draw 是一个功能完善的数字白板应用，支持多种绘图工具、文本编辑、画布操作等功能。应用采用插件化架构设计，核心系统保持简洁稳定，功能通过插件扩展，具有高度的灵活性和可维护性。

### 核心功能

- **绘图工具**：选择、平移、矩形、圆形、直线、箭头、画笔、文本、图片
- **画布操作**：缩放（鼠标滚轮、按钮）、平移（工具和空格键）、无限画布
- **对象管理**：对象添加、删除、选择、移动、缩放
- **快捷键支持**：所有工具支持键盘快捷键，支持快捷键冲突检测
- **插件化架构**：完整的工具插件系统，支持工具注册、生命周期管理、事件系统、Hook 系统、快捷键管理和依赖管理

## 技术栈

### 核心框架

- **Vue 3** - 渐进式 JavaScript 框架
- **TypeScript** - 类型安全的 JavaScript 超集
- **Vite** - 下一代前端构建工具

### 绘图引擎

- **Leafer UI** - 高性能 Canvas 渲染引擎
- **@leafer-in/editor** - 对象编辑功能（选择、移动、缩放）
- **@leafer-in/viewport** - 视口和缩放功能
- **@leafer-in/view** - 视图功能
- **@leafer-in/arrow** - 箭头绘制功能
- **@leafer-in/text-editor** - 文本编辑功能

### 状态管理

- **Pinia** - Vue 官方状态管理库

### UI 组件库

- **Naive UI** - Vue 3 组件库
- **Tailwind CSS** - 实用优先的 CSS 框架

### 工具库

- **VueUse** - Vue Composition API 工具集合

### 开发工具

- **Biome** - 快速、可靠的代码检查和格式化工具
- **Husky** - Git hooks 工具
- **lint-staged** - 对暂存文件运行 linter

## 架构设计

### 插件化架构

wl-draw 采用微内核插件化架构，遵循以下核心原则：

#### 1. 核心与插件分离

- **微内核**：核心系统保持最小化和稳定，仅包含基础功能和插件管理机制
- **功能模块化**：业务功能以插件形式存在，每个插件负责独立功能
- **职责清晰**：核心系统管理插件生命周期，插件实现具体功能

#### 2. 统一的插件接口规范

- **ToolPlugin 接口**：定义插件必须实现的统一接口
- **插件元数据**：包含版本、描述、依赖等信息
- **能力声明**：通过 `capabilities` 声明插件行为，系统自动调整
- **工具实例**：插件通过 `createTool` 创建工具实例，实现具体功能

#### 3. 插件管理机制

- **插件注册表（PluginRegistry）**：统一管理所有插件的注册、查询、卸载
- **插件验证**：注册时验证插件规范、依赖关系、版本兼容性
- **生命周期管理**：支持插件安装、激活、停用、卸载等生命周期
- **依赖管理**：支持插件依赖声明和依赖顺序计算

#### 4. 通信机制

- **事件驱动**：基于事件总线的插件间通信机制
- **类型安全**：事件系统提供完整的 TypeScript 类型支持
- **事件管理**：自动跟踪事件订阅，插件卸载时自动清理

#### 5. Hook 系统

- **生命周期钩子**：在关键节点（工具切换、绘制开始/完成）执行自定义逻辑
- **拦截器钩子**：支持在操作前拦截（如阻止工具切换）
- **处理器钩子**：支持在操作后执行后续处理

#### 6. 能力驱动设计

插件通过 `capabilities` 声明能力，系统根据能力自动：

- 切换画布模式（绘图模式/普通模式）
- 分发事件（拖拽、点击等）
- 启用/禁用功能（如拖拽平移）

### 架构层次

```
┌─────────────────────────────────────┐
│          UI 层 (Vue Components)     │
│  Toolbar, Canvas, ToolSelector...  │
└─────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────┐
│        核心系统 (Core System)        │
│  - 插件注册表 (PluginRegistry)       │
│  - 事件总线 (EventBus)               │
│  - Hook 系统 (Hook System)           │
│  - 工具管理器 (Tool Manager)         │
└─────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────┐
│        插件层 (Plugin Layer)         │
│  - 内置插件 (Builtin Plugins)        │
│  - 工具插件 (Tool Plugins)           │
│  - 扩展插件 (Extension Plugins)      │
└─────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────┐
│        基础设施层 (Infrastructure)    │
│  - Leafer UI (绘图引擎)              │
│  - Pinia (状态管理)                  │
│  - VueUse (工具库)                   │
└─────────────────────────────────────┘
```

### 核心模块

- **插件系统** (`src/plugins/`)：插件注册、管理、事件、Hook、快捷键
- **状态管理** (`src/stores/`)：画布状态、工具状态、对象管理
- **工具组合函数** (`src/composables/`)：工具逻辑封装和复用
- **组件** (`src/components/`)：UI 组件（工具栏、画布、工具选择器等）
- **配置** (`src/config/`)：画布配置、主题配置、导出配置

### 插件开发

插件开发遵循统一的接口规范，支持：

- **工具插件**：实现绘图工具（矩形、圆形、画笔等）
- **选择工具**：实现对象选择和操作
- **实用工具**：实现辅助功能（导出、导入等）

详细的插件开发指南请参考 [插件开发指南](./docs/插件开发指南.md)。
